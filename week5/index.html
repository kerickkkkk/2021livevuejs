<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2021-Live-Vue-JS-week5</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>
<body>
  <div id="app">
    <!-- 產品區塊 -->
    <div class="container">
      <h3>產品區塊</h3>
      <div class="row">
        <div class="col-md-4" v-for="item in products" :key="item.id">
          <div class="card">
            <img :src="item.imageUrl" class="card-img-top" alt="圖片">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <h5 class="card-title">{{item.title}}</h5>
                <div>
                  <div class="badge rounded-pill bg-secondary h5">{{item.category}}</div>

                </div>
              </div>
              <del>${{item.origin_price}}</del>
              <span class="text-danger h5 ml-auto">${{item.price}}</span>

              <button class="btn btn-outline-primary" type="button" >
                <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                Loading...

                看詳細
              </button>
              <button class="btn btn-danger" type="button" >
                <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                Loading...

                加入購物車
              </button>
            </div>
          </div>
        </div>
      </div>
      <template v-if="pagination">
        <pagination :pagination = "pagination" @get-products ="getProducts"></pagination>
      </template>
      <!-- 購物車區塊 -->
      <div class="row">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">First</th>
              <th scope="col">Last</th>
              <th scope="col">Handle</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">1</th>
              <td>Mark</td>
              <td>Otto</td>
              <td>@mdo</td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td>Jacob</td>
              <td>Thornton</td>
              <td>@fat</td>
            </tr>
            <tr>
              <th scope="row">3</th>
              <td colspan="2">Larry the Bird</td>
              <td>@twitter</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- 驗證表單 -->
    
      
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.9.1/axios.min.js' integrity='sha512-Xk3wWei2TGrsh9kDSBKUMIjw/86sLUvhtnv9f7fOuIwhhiUTKz8szkWkzHthrM5Bb3Bu9idSzkxOrkzhcneuiw==' crossorigin='anonymous'></script>
  <!-- 分頁  template -->
  <script type="x-template" id="pagination">
    <nav>
      <ul class="pagination justify-content-center">
        <li @click="getProducts(watchPagination.currentPage-1)" class="page-item " :class="{disabled: !watchPagination.has_pre}">
          <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
        </li>
        <li @click="getProducts(page)" v-for="page in watchPagination.total_pages" :class="{active: page === watchPagination.current_page}" :key="page" class="page-item">
          <a class="page-link" href="#">{{page}}</a>
        </li>
        <li @click="getProducts(watchPagination.current_page+1)" class="page-item"  :class="{disabled: !watchPagination.has_next}">
          <a class="page-link" href="#">Next</a>
        </li>
      </ul>
    </nav>
  </script>
  <script type="module">
    import {createApp} from 'https://cdnjs.cloudflare.com/ajax/libs/vue/3.0.9/vue.esm-browser.js';
    const apiUrl =  "https://vue3-course-api.hexschool.io";
    const apiPath =  "pet";

    createApp({
      data(){
        return {
          products:null,
          pagination: null
        }
      },
      methods:{
        openModal(){
          this.$refs.modalA.openModal()
        },
        getProducts(page = 1){
          axios.get(`${apiUrl}/api/${apiPath}/products?page=${page}`)
          .then((res)=>{
            if(res.data.success){
              const {products, pagination} = res.data
              this.products = products;
              this.pagination = pagination
            }else{
              alert(res.data.message)
            }
            
          }).catch((error)=>{
            console.log(error);
          })
        }
      },
      mounted(){
        this.getProducts()
      }
    })
    .component('card',{
      template:`<button class="btn btn-primary">{{name}}</button>`,
      data(){
        return {
          name:'Eric'
        }
      }
    })
    .component('modal',{
      template:`<div ref="modal" class="modal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Modal title</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p>Modal body text goes here.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>`,
      data(){
        return{
          modal:''
        }
      },
      methods: {
        openModal(){
          this.modal.show()
        }
      },
      mounted(){
        this.modal = new bootstrap.Modal(this.$refs.modal)
      }
    })
    .component('pagination',{
      template: '#pagination',
      props:{
        pagination:{
          type: Object,
        }
        // currentPage:{
        //   type: Number,
        // },
        // hasNext:{
        //   type: Boolean,
        // },
        // hasPre:{
        //   type: Boolean,
        // },
        // totalPages:{
        //   type: Number,
        // },
      },
      data(){
        return{
          watchPagination : {
            category: null,
            current_page: null,
            has_next: false,
            has_pre: false,
            total_pages: null,
          }
        }
      },
      watch:{
        pagination:{
          handler(){
            this.watchPagination = {...this.pagination}
          },
          immediate:true
        }
      },
      methods:{
        getProducts(page){
          this.$emit('get-products',page)
        }
      }
    })
    .mount('#app');
    
  </script>
</body>
</html>